---
title: "butter"
format: html
editor: source
---


```{r}
library(tidyverse)
library(tastyR)
rec <- allrecipes
```

I am assuming that if there is butter OR option that people are choosing butter
When optional or for greasing with no amount specified i did not include


```{r}
butter <- allrecipes %>% 
  mutate(butter = ifelse(str_detect(ingredients, "butter|Butter"), "yes", "no")) %>% 
  filter(!is.na(ingredients)) %>% 
  dplyr::select(name, date_published, ingredients, avg_rating, total_ratings, servings, butter) %>% 
   separate_wider_delim(cols = ingredients, delim = ",", names_sep = "_", too_few = "align_start") %>% 
   rowwise() %>%
  mutate(butter_ingredient = {
    ingredients <- c_across(starts_with("ingredients_"))
    butter_match <- ingredients[grepl("butter", ingredients, ignore.case = TRUE)]
    if(length(butter_match) > 0) butter_match[1] else NA_character_
  }) %>%
  ungroup() %>% 
  dplyr::select(-(3:48)) %>% 
  mutate(butter = ifelse(str_detect(butter_ingredient, "peanut butter|Peanut Butter|buttermilk|butter lettuce|vegan butter|Buttery|buttery|butternut|butterhead|butter beans|butterscotch|Butterball|butterflied|bread and butter pickle chips|butter flavored|buttercream|pumpkin butter|Nutter Butter|apple butter|almond butter|vegan|whole butter or Bibb lettuce leaves|butter-flavored|Buttershots|buttercup|Butter Flavor|butter pecan") & !is.na(butter_ingredient) , "no", butter),
         butter_ingredient = ifelse(butter == "no", NA, butter_ingredient),
         butter_ingredient = ifelse(name =="Orange, Tea, Bourbon-Brined Paprika Butter Turkey", "6 tablespoons butter",butter_ingredient)) %>% 
  mutate(across(where(is.character), str_trim),
         tablespoons = case_when(str_detect(butter_ingredient, "1 tablespoon") ~ 1,
                                 str_detect(butter_ingredient, "1 ½ tablespoons") ~ 1.5,
                                 str_detect(butter_ingredient, "2 tablespoon") ~ 2,
                                 str_detect(butter_ingredient, "3 tablespoon") ~ 3,
                                 str_detect(butter_ingredient, "6 tablespoon") ~ 6,
                                 str_detect(butter_ingredient, "10 tablespoon") ~ 10,
                                 str_detect(butter_ingredient, "1 cup") ~ 16,
                                 str_detect(butter_ingredient, "1/2 cup") ~ 8,
                                 str_detect(butter_ingredient, "½ cup") ~ 8,
                                 str_detect(butter_ingredient, "¼ cup ") ~ 4,
                                 str_detect(butter_ingredient, "1 ½ cup") ~ 24,
                                 str_detect(butter_ingredient, "1 1/4 cup") ~ 20,
                                 str_detect(butter_ingredient, ".79100000858307 cup ") ~ 12.656,
                                 str_detect(butter_ingredient, "1 ½ sticks") ~ 12,
                                 str_detect(butter_ingredient, "1 ½ teaspoons") ~ 0.5,
                                 str_detect(butter_ingredient, "1 ⅓ cups") ~ 21.33,
                                 str_detect(butter_ingredient, "1 ¼ cups") ~ 28,
                                 str_detect(butter_ingredient, "1 ounce") ~ 2,
                                 str_detect(butter_ingredient, "1 pound") ~ 32,
                                 str_detect(butter_ingredient, "1 rounded tablespoon") ~ 1,
                                 str_detect(butter_ingredient, "1 stick") ~ 8,
                                 str_detect(butter_ingredient, "1 teaspoon") ~ 0.33,
                                 str_detect(butter_ingredient, "½ pound") ~ 16,
                                 str_detect(butter_ingredient, "½ stick") ~ 4,
                                 str_detect(butter_ingredient, "½ tablespoon") ~ 0.5,
                                 str_detect(butter_ingredient, "⅓ cup") ~ 5.33,
                                 str_detect(butter_ingredient, "2 cups") ~ 32,
                                 str_detect(butter_ingredient, "2 sticks") ~ 16,
                                 str_detect(butter_ingredient, "2 ounces") ~ 4,
                                 str_detect(butter_ingredient, "2 pounds") ~ 64,
                                 str_detect(butter_ingredient, "1 1/2 teaspoons") ~ 0.5,
                                 str_detect(butter_ingredient, "1 ⅛ cups") ~ 18,
                                 str_detect(butter_ingredient, "1 ¾ cups") ~ 28,
                                 str_detect(butter_ingredient, "1/3 cup") ~ 5.33,
                                 str_detect(butter_ingredient, "1/4 ") ~ 4,
                                 str_detect(butter_ingredient, "½ teaspoon") ~ 0.17,
                                 str_detect(butter_ingredient, "¼ pound") ~ 8,
                                 str_detect(butter_ingredient, "¼ stick") ~ 4,
                                 str_detect(butter_ingredient, "10 teaspoons") ~ 3.33,
                                 str_detect(butter_ingredient, "14 tablespoons") ~ 14,
                                 str_detect(butter_ingredient, "2 Tablespoons") ~ 2,
                                 str_detect(butter_ingredient, "2 teaspoons") ~ 0.67,
                                 str_detect(butter_ingredient, "2/3 cup") ~ 10.67,
                                 str_detect(butter_ingredient, "3 sticks") ~ 23,
                                 str_detect(butter_ingredient, "3 teaspoons") ~ 1,
                                 str_detect(butter_ingredient, "3/4 cup") ~ 12,
                                 str_detect(butter_ingredient, "¾ cup") ~ 12,
                                 str_detect(butter_ingredient, "4 tablespoons") ~ 4,
                                 str_detect(butter_ingredient, "5 tablespoons") ~ 5,
                                 str_detect(butter_ingredient, "7 ounces") ~ 14,
                                 str_detect(butter_ingredient, "8 pounds") ~ 256,
                                 str_detect(butter_ingredient, "8 tablespoons") ~ 8,
                                 str_detect(butter_ingredient, "8 teaspoons") ~ 2.67,
                                 str_detect(butter_ingredient, "9 tablespoons") ~ 9,
                                 str_detect(butter_ingredient, "1 ¾ cup") ~ 28,
                                 str_detect(butter_ingredient, "1⁄3 cup") ~ 5.33,
                                 str_detect(butter_ingredient, "⅔ cup") ~ 10.67,
                                 str_detect(butter_ingredient, "¾ pound") ~ 24,
                                 str_detect(butter_ingredient, "¾ stick") ~ 12,
                                 str_detect(butter_ingredient, "⅜ cup") ~ 6,
                                 str_detect(butter_ingredient, "4 ounces") ~ 8,
                                 str_detect(butter_ingredient, "4 thin pats") ~ 8,
                                 str_detect(butter_ingredient, "5 ⅓ tablespoons") ~ 5.33,
                                 str_detect(butter_ingredient, "7 tablespoons") ~ 7,
                                 str_detect(butter_ingredient, "4 teaspoons") ~ 1.33,
                                 name == "Chef John's Pumpkin Scones" ~ 6,
                                 name == "Cherry Pie with Almond Crumb Topping" ~ 6,
                                 name == "Biscuit Cinnamon Rolls" ~ 4,
                                 name == "Panini Sandwiches" ~ NA, ## optional with no amount recommended
                                 name == "Purple Carrot Cake" ~ NA, ##  no amount recommended
                                 name == "Dobos Torte" ~ NA, ##  no amount recommended - just for greasing
                                 name == "Southern Peach Shortcake" ~ 2,
                                 name == "Cornes de Gazelle (Gazelle Horns)" ~ 8,
                                 name == "Jiffy Jalapeno Cheese Cornbread Muffins" ~ NA,## optional with no amount recommended
                                 name == "The Real Chicago Deep-Dish Pizza Dough" ~ NA,##  no amount recommended - just for greasing
                                 name == "Cranberry-Orange Scones" ~ 8)) %>% 
  filter(!(name %in% c("Panini Sandwiches","Purple Carrot Cake" , "Dobos Torte","Jiffy Jalapeno Cheese Cornbread Muffins","The Real Chicago Deep-Dish Pizza Dough"))) %>% 
  left_join(allrecipes) %>% 
    dplyr::select(-url) %>% 
  mutate(tablespoons = ifelse(!is.na(tablespoons), tablespoons, 0),
         butter_per_serving = tablespoons/servings)

 # chk <- butter %>% 
 #   filter(butter == "yes",
 #          is.na(tablespoons))
```



- what recipe has the most butter, which one has the least
- is more butter (per serving) better?
- how many recipes had butter
- are butter forward recipe published more in the winter season?

 
```{r}
hist(butter$tablespoons)

just_butter <- butter %>% 
  filter(tablespoons > 0)

ggplot(just_butter) +
  geom_point(aes(x=avg_rating, y = butter_per_serving))

ggplot(just_butter) +
  geom_bar(aes(x=avg_rating, y = butter_per_serving), stat = "identity")


```

plots are kinda blah though

distribution of recipes ratings with and without butter, two plots

stats
```{r}
lm_per_serv <- lm(avg_rating~butter_per_serving, data=just_butter)
summary(lm_per_serv)

lm_per_recipe <- lm(avg_rating~tablespoons, data=just_butter)
summary(lm_per_recipe)


spearman_test <- cor.test(butter$butter_per_serving, butter$avg_rating,
                          method = "spearman")
print(spearman_test) ## p-value is significant, the butter per serving doe significanlty impact the average rating of the recipe

# Extract specific values
spearman_test$estimate  # rho value
spearman_test$p.value   # significance

ggplot(butter, aes(y = butter_per_serving, x = avg_rating)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = paste("Spearman's ρ =", round(spearman_coef, 3)))
```




